# ============================================================
# TRINITY OF LUCK - API Gateway Environment Configuration
# ============================================================
# Copy this file to .env and fill in your actual values
# For Production: Use strong, unique values for all secrets

# ============================================================
# SERVER CONFIGURATION
# ============================================================
NODE_ENV=production
PORT=3001
HOST=0.0.0.0

# ============================================================
# DATABASE (PostgreSQL via Supabase)
# ============================================================
# Get these from Supabase Project Settings → Database
DATABASE_URL=postgresql://postgres:your_password@your-project.supabase.co:5432/postgres?sslmode=require
DATABASE_POOL_SIZE=20
DATABASE_IDLE_TIMEOUT=30000
DATABASE_QUERY_TIMEOUT=30000
DATABASE_SSL=true

# ============================================================
# REDIS (Cache & Queue Backend)
# ============================================================
# For Railway/Heroku, get connection URL from provider
REDIS_URL=redis://:password@host:port/0
REDIS_CACHE_DB=0
REDIS_QUEUE_DB=1
REDIS_TIMEOUT=30000

# ============================================================
# SUPABASE CONFIGURATION
# ============================================================
# Get these from Supabase Project Settings → API
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

# ============================================================
# AUTHENTICATION
# ============================================================
# Generate with: openssl rand -base64 32
JWT_SECRET=your-super-secret-jwt-key-change-in-production
JWT_EXPIRY=7d
ACCESS_TOKEN_EXPIRY=1h
REFRESH_TOKEN_EXPIRY=30d

# ============================================================
# STRIPE CONFIGURATION
# ============================================================
# Get these from Stripe Dashboard → Developers → API Keys
STRIPE_SECRET_KEY=sk_live_your_stripe_secret_key
STRIPE_PUBLISHABLE_KEY=pk_live_your_stripe_publishable_key
STRIPE_WEBHOOK_SECRET=whsec_your_stripe_webhook_secret

# ============================================================
# BULL QUEUE SYSTEM (Job Processing)
# ============================================================
QUEUE_DEFAULT_ATTEMPTS=3
QUEUE_DEFAULT_BACKOFF_DELAY=5000
QUEUE_CONCURRENCY=10
QUEUE_MAX_LOCK_TIME=30000

# Queue-specific settings
ANALYSIS_QUEUE_CONCURRENCY=5
EMAIL_QUEUE_CONCURRENCY=15
NOTIFICATION_QUEUE_CONCURRENCY=20
WEBHOOK_QUEUE_CONCURRENCY=10
CLEANUP_QUEUE_CONCURRENCY=1

# ============================================================
# EMAIL SERVICE (SendGrid/SMTP)
# ============================================================
EMAIL_SERVICE=sendgrid
SENDGRID_API_KEY=SG.your-sendgrid-api-key
EMAIL_FROM=noreply@trinity-of-luck.com
EMAIL_FROM_NAME=Trinity of Luck

# Alternative SMTP Configuration
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
SMTP_SECURE=true

# ============================================================
# RATE LIMITING
# ============================================================
# Time window for rate limiting in milliseconds
RATE_LIMIT_WINDOW_MS=60000

# Maximum requests allowed per window
RATE_LIMIT_MAX_REQUESTS=100

# ============================================================
# CORS CONFIGURATION
# ============================================================
# Comma-separated list of allowed origins for production
CORS_ORIGIN=https://trinity-of-luck.com,https://www.trinity-of-luck.com,https://app.trinity-of-luck.com

# ============================================================
# SECURITY
# ============================================================
# HTTPS requirement (always true in production)
HTTPS_REQUIRED=true

# Helmet security headers
HELMET_ENABLED=true
HELMET_CSP_ENABLED=true

# CSRF Protection
CSRF_ENABLED=true

# API Key for internal services
INTERNAL_API_KEY=your-internal-api-key-change-in-production

# ============================================================
# LOGGING & MONITORING
# ============================================================
# Log level: error, warn, info, debug, trace
LOG_LEVEL=info

# Sentry for error tracking
SENTRY_DSN=https://your-sentry-dsn@sentry.io/your-project-id
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_PROFILES_SAMPLE_RATE=0.1

# Datadog APM (optional)
DATADOG_ENABLED=false
DATADOG_AGENT_HOST=localhost
DATADOG_AGENT_PORT=8126
DATADOG_TRACE_SAMPLE_RATE=0.1

# ============================================================
# EXTERNAL SERVICES
# ============================================================
# Analysis Service (if separate)
ANALYSIS_SERVICE_URL=https://api-analysis.trinity-of-luck.com
ANALYSIS_SERVICE_API_KEY=your-analysis-service-api-key

# Webhook URLs for external integrations
WEBHOOK_VERIFY_TOKEN=your-webhook-verification-token

# ============================================================
# API DOCUMENTATION
# ============================================================
# Swagger/OpenAPI configuration
SWAGGER_ENABLED=true
SWAGGER_TITLE=Trinity of Luck API Gateway
SWAGGER_VERSION=1.0.0
API_BASE_URL=/api

# ============================================================
# FEATURE FLAGS
# ============================================================
FEATURE_ANALYSIS_V2=true
FEATURE_ADVANCED_CHARTS=true
FEATURE_BETA_FEATURES=false

# ============================================================
# PERFORMANCE TUNING
# ============================================================
# Node.js memory limit (in MB)
NODE_MEMORY=512

# Compression for HTTP responses
COMPRESSION_ENABLED=true
COMPRESSION_LEVEL=6

# HTTP Keep-Alive settings
HTTP_KEEP_ALIVE=true
HTTP_KEEP_ALIVE_TIMEOUT=5000

# Request body size limits
REQUEST_SIZE_LIMIT=10mb

# ============================================================
# TESTING (CI/CD Environment)
# ============================================================
TEST_DATABASE_URL=postgresql://postgres:password@localhost:5432/trinity_test
TEST_REDIS_URL=redis://localhost:6379/2
TEST_TIMEOUT=30000

# ============================================================
# API SECURITY
# ============================================================
# Secret key for validating API requests (X-API-Key header)
API_SECRET_KEY=your-secure-api-secret-key

