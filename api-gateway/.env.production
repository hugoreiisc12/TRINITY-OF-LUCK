# ============================================================
# TRINITY OF LUCK - API Gateway Production Environment
# ============================================================
# Copy to .env and set all values before deployment
# Never commit this file to version control!
# Use your platform's secret management (GitHub Secrets, etc.)

# ============================================================
# SERVER CONFIGURATION
# ============================================================
NODE_ENV=production
PORT=3001
HOST=0.0.0.0

# ============================================================
# DATABASE (PostgreSQL)
# ============================================================
# PostgreSQL connection string from Supabase or other provider
# Format: postgresql://user:password@host:port/database?sslmode=require
DATABASE_URL=postgresql://postgres:YOUR_PASSWORD@your-project.supabase.co:5432/postgres?sslmode=require
DATABASE_POOL_SIZE=20
DATABASE_IDLE_TIMEOUT=30000
DATABASE_QUERY_TIMEOUT=30000
DATABASE_SSL=true

# ============================================================
# REDIS (Cache & Queue Backend)
# ============================================================
# Redis connection URL from Railway, Heroku, or other provider
# Format: redis://:password@host:port/db
REDIS_URL=redis://:YOUR_PASSWORD@your-redis-host:6379/0
REDIS_CACHE_DB=0
REDIS_QUEUE_DB=1
REDIS_TIMEOUT=30000

# ============================================================
# SUPABASE CONFIGURATION
# ============================================================
# Get from Supabase Project Settings → API
SUPABASE_URL=https://YOUR_PROJECT.supabase.co
SUPABASE_ANON_KEY=YOUR_ANON_KEY_HERE
SUPABASE_SERVICE_ROLE_KEY=YOUR_SERVICE_ROLE_KEY_HERE

# ============================================================
# AUTHENTICATION
# ============================================================
# Generate with: openssl rand -base64 32
JWT_SECRET=YOUR_GENERATED_JWT_SECRET_HERE
JWT_EXPIRY=7d
ACCESS_TOKEN_EXPIRY=1h
REFRESH_TOKEN_EXPIRY=30d

# ============================================================
# STRIPE (LIVE KEYS - NOT TEST)
# ============================================================
# Get from Stripe Dashboard → Developers → API Keys
# IMPORTANT: Use sk_live_* for production (NOT sk_test_*)
STRIPE_SECRET_KEY=sk_live_YOUR_LIVE_SECRET_KEY
STRIPE_PUBLISHABLE_KEY=pk_live_YOUR_LIVE_PUBLISHABLE_KEY
STRIPE_WEBHOOK_SECRET=whsec_YOUR_WEBHOOK_SECRET

# ============================================================
# BULL QUEUE SYSTEM (Job Processing)
# ============================================================
# Number of jobs to process concurrently
QUEUE_DEFAULT_ATTEMPTS=3
QUEUE_DEFAULT_BACKOFF_DELAY=5000
QUEUE_CONCURRENCY=10
QUEUE_MAX_LOCK_TIME=30000

# Queue-specific concurrency settings
ANALYSIS_QUEUE_CONCURRENCY=5
EMAIL_QUEUE_CONCURRENCY=15
NOTIFICATION_QUEUE_CONCURRENCY=20
WEBHOOK_QUEUE_CONCURRENCY=10
CLEANUP_QUEUE_CONCURRENCY=1

# ============================================================
# EMAIL SERVICE (SendGrid)
# ============================================================
# Use SendGrid for production reliability
EMAIL_SERVICE=sendgrid
SENDGRID_API_KEY=SG.YOUR_SENDGRID_API_KEY
EMAIL_FROM=noreply@trinity-of-luck.com
EMAIL_FROM_NAME=Trinity of Luck

# Alternative: SMTP Configuration (if not using SendGrid)
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USER=your-email@gmail.com
# SMTP_PASSWORD=your-app-specific-password
# SMTP_SECURE=true

# ============================================================
# RATE LIMITING
# ============================================================
# Time window for rate limiting in milliseconds (1 minute)
RATE_LIMIT_WINDOW_MS=60000

# Maximum requests allowed per window per IP
RATE_LIMIT_MAX_REQUESTS=100

# ============================================================
# CORS CONFIGURATION
# ============================================================
# Comma-separated list of allowed origins
# IMPORTANT: Use HTTPS in production
CORS_ORIGIN=https://trinity-of-luck.com,https://www.trinity-of-luck.com,https://app.trinity-of-luck.com

# ============================================================
# SECURITY
# ============================================================
# HTTPS requirement (always true in production)
HTTPS_REQUIRED=true

# Helmet security headers
HELMET_ENABLED=true
HELMET_CSP_ENABLED=true

# CSRF Protection
CSRF_ENABLED=true

# API Key for internal service-to-service communication
# Generate with: openssl rand -base64 32
INTERNAL_API_KEY=YOUR_GENERATED_INTERNAL_API_KEY

# ============================================================
# LOGGING & MONITORING
# ============================================================
# Log level: error, warn, info, debug, trace
LOG_LEVEL=info

# Sentry for error tracking
# Get from Sentry.io → Project Settings → DSN
SENTRY_DSN=https://YOUR_SENTRY_KEY@sentry.io/YOUR_PROJECT_ID
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_PROFILES_SAMPLE_RATE=0.1

# Datadog APM (optional - advanced monitoring)
DATADOG_ENABLED=false
DATADOG_AGENT_HOST=localhost
DATADOG_AGENT_PORT=8126
DATADOG_TRACE_SAMPLE_RATE=0.1

# ============================================================
# EXTERNAL SERVICES
# ============================================================
# Analysis Service (if deployed separately)
ANALYSIS_SERVICE_URL=https://api-analysis.trinity-of-luck.com
ANALYSIS_SERVICE_API_KEY=YOUR_ANALYSIS_SERVICE_API_KEY

# Webhook verification token
# Generate with: openssl rand -base64 32
WEBHOOK_VERIFY_TOKEN=YOUR_GENERATED_WEBHOOK_TOKEN

# ============================================================
# API DOCUMENTATION
# ============================================================
# Swagger/OpenAPI configuration
SWAGGER_ENABLED=true
SWAGGER_TITLE=Trinity of Luck API Gateway
SWAGGER_VERSION=1.0.0
API_BASE_URL=/api

# ============================================================
# FEATURE FLAGS
# ============================================================
# Enable/disable features in production
FEATURE_ANALYSIS_V2=true
FEATURE_ADVANCED_CHARTS=true
FEATURE_BETA_FEATURES=false

# ============================================================
# PERFORMANCE TUNING
# ============================================================
# Node.js memory limit (in MB)
NODE_MEMORY=512

# Compression for HTTP responses
COMPRESSION_ENABLED=true
COMPRESSION_LEVEL=6

# HTTP Keep-Alive settings (in milliseconds)
HTTP_KEEP_ALIVE=true
HTTP_KEEP_ALIVE_TIMEOUT=5000

# Request body size limits
REQUEST_SIZE_LIMIT=10mb

# ============================================================
# NOTES FOR DEPLOYMENT
# ============================================================
# 1. Never commit this file to git
# 2. Use your platform's secret management:
#    - Railway: Dashboard → Variables
#    - Heroku: CLI: heroku config:set VAR=value
#    - GitHub: Settings → Secrets and variables
#
# 3. Verify all values before deployment:
#    - Database URL is correct and reachable
#    - Redis URL is correct and reachable
#    - All keys are live (not test) for payment services
#    - Email service is configured correctly
#
# 4. Test database connection:
#    psql $DATABASE_URL -c "SELECT NOW();"
#
# 5. Run migrations:
#    ./scripts/db-migrate.sh
#
# 6. Test application startup locally:
#    npm run build && npm start
